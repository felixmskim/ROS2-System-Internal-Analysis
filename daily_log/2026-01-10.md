# 📅 2026-01-10

## 🎯 목표
- WSL2 환경에서 ROS2 시뮬레이션을 위한 GPU 하드웨어 가속(WSLg) 환경 구축 및 첫 시뮬레이션 구동

## 📝 학습 내용
- **[이론] vGPU(GPU Paravirtualization)와 D3D12 매핑:** 가상화 환경에서 리눅스 게스트가 호스트 GPU를 활용해 OpenGL 명령을 DirectX 12로 변환하여 처리하는 구조 이해
- **[실습] Intel Arc A350M 최적화:** 외장 GPU 드라이버 모델(WDDM3.0) 확인 및 고성능 그래픽 설정 적용
- **[실습] ROS2 시뮬레이터 설치:** Turtlesim(3D) 및 Webots(3D) 설치 및 노드 통신 테스트

## 🔍 소스코드 분석: geometry_msgs/msg/Twist
- **핵심코드:** `turtlesim_drawer/drawer_node.py`
```python
from geometry_msgs.msg import Twist

# Twist 메시지는 로봇의 선속도(Linear)와 각속도(Angular)를 정의함
msg = Twist()
msg.linear.x = 2.0   # 전진 속도 (m/s)
msg.angular.z = 1.57 # 회전 속도 (rad/s, 약 90도)
self.publisher_.publish(msg)
```
- ROS2 로봇 제어의 표준 메시지 타입으로 `rclpp`나 `rclpy`를 통해 시뮬레이터 내 로봇의 물리적 움직임을 결정하는 핵심 인터페이스임.

## 🔍 직면한 문제 & 해결 (Troubleshooting)
- **문제**: 하드웨어 가속은 활성화되었으나 외장 GPU(Arc A350M)가 아닌 내장 GPU(Iris Xe)가 렌더러로 표시됨.
- **원인**: Windows의 전력 관리 정책에 의해 WSL2 프로세스(`wsl.exe`)에 기본 GPU(iGPU)가 우선 할당됨.
- **해결**: 
  1. Windows 그래픽 설정에서 `wsl.exe`의 기본 설정을 [고성능]으로 변경하여 Arc A350M을 강제 할당.
  2. Mesa 환경 변수(`MESA_D3D12_DEFAULT_ADAPTER_NAME`)를 통해 하드웨어 매핑 우선순위 조정 시도 중.

- **문제:** glxinfo 확인 시 렌더러가 llvmpipe로 표시되며 시뮬레이션 실행 시 CPU 점유율 급증

- **원인:** Intel Arc A350M 드라이버와 윈도우 업데이트 서비스 간의 충돌로 인해 장치 관리자에서 에러 코드 43 발생 및 vGPU 매핑 실패

- **해결:** 
    1. **DDU(Display Driver Uninstaller)**를 사용하여 기존 드라이버 및 IntelGFXFWupdateTool 서비스 완전 제거 

    2. 제조사(Intel) 공식 홈페이지에서 최신 통합 드라이버 Clean Install 

    3. ~/.bashrc에 export GALLIUM_DRIVER=d3d12 추가하여 하드웨어 가속 강제 지정

## 💡 인사이트 (오늘 깨달은 것)
- Environment Setup은 단순히 앱을 까는 것이 아니라, OS와 하드웨어 사이의 추상화 계층을 이해하는 과정임을 깨달았다.

- 저사양 노트북일수록 GPU 오프로딩이 시스템 전체의 Real-Time Factor를 유지하는 데 결정적인 역할을 한다.

## 🔗 참고 자료
- [Official] Microsoft: Run GUI apps on WSL (WSLg)

- [Driver] Intel Support: Arc & Iris Xe Graphics Driver

- [ROS2] Turtlesim & Webots 공식 문서 가이드