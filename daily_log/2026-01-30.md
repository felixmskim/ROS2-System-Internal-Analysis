# 📅 2026-01-30

## 🎯 목표
- Docker 컨테이너 내에서 WSLg 및 vGPU 하드웨어 가속 환경 구축
- 내장 그래픽(Iris Xe)이 아닌 외장 그래픽(Arc A350M)을 컨테이너에 강제 할당하여 시뮬레이션 성능 최적화

## 📝 학습 내용
- **Docker 하드웨어 패스스루:** 컨테이너는 호스트와 격리되어 있으므로 `/dev/dxg` 장치와 `/usr/lib/wsl` 라이브러리를 직접 마운트해야 GPU 접근이 가능하다는 것을 학습함.

- **Mesa D3D12 드라이버 설정:** WSL2 환경에서 리눅스의 OpenGL 명령어를 윈도우의 DirectX 12로 매핑하여 하드웨어 가속을 구현하는 원리를 이해함.

- **환경 변수를 통한 GPU 우선순위 제어:** 다중 GPU 환경(내장+외장)에서 `MESA_D3D12_DEFAULT_ADAPTER_NAME` 변수를 사용하여 특정 그래픽 카드를 강제 지정하는 법을 익힘.

## 🔍 직면한 문제 & 해결 (Troubleshooting)

1. 컨테이너 내 `glxinfo` 명령행 오류

- **문제:** `bash: glxinfo: command not found` 에러 발생.

- **원인:** Docker 기본 이미지에 그래픽 유틸리티 패키지가 포함되어 있지 않음.

- **해결:** `Dockerfile`에 `mesa-utils` 설치 구문을 추가하여 해결함.

2. 가속 실패 및 소프트웨어 렌더링(llvmpipe) 문제

- **문제:** `glxinfo` 확인 시 `OpenGL renderer string: llvmpipe`라고 출력되며 CPU가 연산을 담당함.

- **원인:** 실행 시 GPU 장치(`--device /dev/dxg`) 연결이 누락되었거나 드라이버 라이브러리 경로가 잡히지 않음.

- **해결:** `docker run` 시 `-v /usr/lib/wsl:/usr/lib/wsl` 옵션을 추가

### 3. 외장 그래픽 대신 내장 그래픽(Iris Xe)이 잡히는 문제
- **문제:** 하드웨어 가속은 되지만, 성능이 낮은 내장 그래픽이 기본으로 잡힘.

- **원인:** 노트북 시스템의 기본 어댑터 우선순위 문제.

- **해결:** export MESA_D3D12_DEFAULT_ADAPTER_NAME=Arc 환경 변수를 설정하여 외장 그래픽인 Arc A350M을 강제 호출하도록 수정함.

## 💡 인사이트 (오늘 깨달은 것)

- Docker는 단순한 파일 시스템 격리를 넘어, 하드웨어 자원을 어떻게 효율적으로 분배하고 연결하느냐가 성능의 핵심임을 깨달음.

- "내 컴퓨터에선 되는데?"라는 문제를 해결하기 위해 Docker를 쓰지만, 그 과정에서 호스트 OS(Windows)와 리눅스 커널 간의 브리지 설정을 완벽히 이해하는 것이 필수적임을 느낌.

- 소프트웨어 렌더링(llvmpipe)과 하드웨어 렌더링(D3D12)의 차이를 직접 눈으로 확인하며 시스템 최적화의 중요성을 체감함.

## 🔗 참고 자료
- [Microsoft Learn] [Linux용 Windows 하위 시스템의 Linux GUI 앱 실행](https://learn.microsoft.com/ko-kr/windows/wsl/tutorials/gui-apps)
- [Mesa Docs] [D3D12 드라이버 환경 변수 설정 가이드](https://docs.mesa3d.org/drivers/d3d12.html)